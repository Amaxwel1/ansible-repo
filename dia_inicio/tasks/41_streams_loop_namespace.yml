---
- name: Listar pods de streams no namespace {{ streams_namespace }}
  kubernetes.core.k8s_info:
    kubeconfig: "{{ kubeconfig_th }}"
    kind: Pod
    namespace: "{{ streams_namespace }}"
  register: streams_pods

- name: Extrair pods que contêm 'stream' e estão Running
  ansible.builtin.set_fact:
    streams_pod_list: >-
      {{
        streams_pods.resources
        | selectattr('status.phase', 'equalto', 'Running')
        | selectattr('metadata.name', 'contains', 'stream')
        | map(attribute='metadata.name')
        | list
      }}

- name: Verificar DELTA em cada pod de streams
  ansible.builtin.include_tasks: 42_streams_verify_delta.yml
  loop: "{{ streams_pod_list }}"
  loop_control:
    loop_var: streams_pod

---
- name: Carregar queries de marketdata
  ansible.builtin.include_vars:
    file: "queries/marketdata.yml"

- name: Verificar papel carregado no stream (tb_bar_one_minute)
  community.postgresql.postgresql_query:
    login_db: "{{ db.name }}"
    login_host: "{{ db.host }}"
    login_port: "{{ db.port }}"
    login_user: "{{ db.user }}"
    login_password: "{{ db.password }}"
    query: "{{ marketdata_queries.check_stream_loaded_paper.sql }}"
  register: md_stream_loaded
  changed_when: false

- name: Montar resumo marketdata
  ansible.builtin.set_fact:
    marketdata_report:
      stream_loaded_rows: "{{ md_stream_loaded.query_result | default([]) }}"
      stream_loaded_rowcount: "{{ md_stream_loaded.rowcount | default(0) }}"
